@echo off
SETLOCAL

echo Compiling assembly file...
ml64 /c /Fo"threadless-asm.obj" threadless-asm.x64.asm
if %errorlevel% neq 0 goto :error

echo Compiling C source files...
cl /c /W3 /GS /Zi /O2 /MD main.c
if %errorlevel% neq 0 goto :error

cl /c /W3 /GS /Zi /O2 /MD threadless.c
if %errorlevel% neq 0 goto :error

echo Linking object files...
link main.obj threadless.obj threadless-asm.obj /OUT:threadless.exe
if %errorlevel% neq 0 goto :error

echo Build succeeded.
goto :end

:error
echo Build failed with error %errorlevel%.
goto :end

:end
ENDLOCAL
